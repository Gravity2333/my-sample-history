var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{rc:()=>a,zR:()=>f,TM:()=>p});const n=class{events=[];get length(){return this.events.length}listen(t){return this.events.push(t),()=>{this.events=this.events.filter((e=>e!==t))}}call(t){this.events.forEach((e=>e&&e(t)))}};function o(t=8){let e="";for(let n=0;n<t;n++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}var a;!function(t){t.POP="POP",t.PUSH="PUSH",t.REPLACE="REPLACE"}(a||(a={}));const r="popstate",c="beforeunload";function s(t){return Object.freeze(t)}function i(t){console.error(t)}function l(t){t.preventDefault(),t.returnValue=""}function u({pathname:t="/",search:e="",hash:n=""}){let o=t;return e&&(e?.startsWith("?")?o+=e:o+=`?${e}`),n&&(n?.startsWith("#")?o+=n:o+=`#${n}`),o}function h(t){const e={pathname:"/",hash:"",search:""},n=t.indexOf("#");n>=0&&(e.hash=t.slice(n),t=t.slice(0,n));const o=t.indexOf("?");return o>=0&&(e.search=t.slice(o),t=t.slice(0,o)),e.pathname=t,e}function f({window:t=document.defaultView}={}){const e=t.history;function f(){const{pathname:n,hash:o,search:a}=t.location,{state:r}=e;return[s({pathname:n,hash:o,search:a,state:r?.usr||null,key:r?.key||"default"}),r?.idx]}const p=new n,d=new n;let[P,y]=f(),v=a.POP;function g(t){return"string"==typeof t?t:u(t)}function E(e,n){const a="string"==typeof e?h(e):e;return s({pathname:t.location.pathname,search:"",hash:"",...a,state:n,key:o()})}function m(t){return!d.length||d.call(t)||!1}function S(t){v=t,[P,y]=f(),p.call({location:P,action:v})}function O(t,e){return[s({usr:t.state,key:t.key,idx:e}),g(t)]}function k(t,n){const o=E(t,n);if(m({location:o,action:a.PUSH,retry:()=>{k(t,n)}})){const[t,n]=O(o,y+1);e.pushState(t,"",n),S(a.PUSH)}}function w(t){e.go(t)}void 0===y&&(y=0,e.replaceState({...e.state,idx:y},""));let L=null;return t.addEventListener(r,(()=>{if(L)d.call(L),L=null;else if(d.length>0){const[t,e]=f();if(void 0!==e){const n=y-e;L={location:t,action:a.POP,retry:()=>{w(-n)}},w(n)}else i("请不要直接使用pushState / replaceState 操作路由！")}else S(a.POP)})),{action:v,location:P,createHref:g,push:k,replace:function(t,n){const o=E(t,n);if(m({location:o,action:a.REPLACE,retry:()=>{k(t,n)}})){const[t,n]=O(o,y+1);e.replaceState(t,"",n),S(a.REPLACE)}},go:w,forward:()=>{w(1)},back:()=>{w(-1)},listen:t=>p.listen(t),block:e=>{const n=d.listen(e);return d?.length>0&&t.addEventListener(c,l),()=>{n(),0===d.length&&t.removeEventListener(c,l)}}}}function p({window:t=document.defaultView}){const e=t.history;function f(){const n=t.location.hash,o=e.state,{pathname:a,search:r,hash:c}=h(n.slice(1));return[s({pathname:a,search:r,hash:c,state:o?.usr,key:o?.key}),o?.idx]}function p(e,n){const a="string"==typeof e?h(e):e;return s({pathname:t.location.pathname,search:"",hash:"",...a,state:n,key:o()})}function d(e){return function(){const e=document.querySelector("base");let n="";if(e&&e.href){const e=t.location.href,o=e.indexOf("#");n=o>=0?e.slice(0,o):e}return""}()+"#"+("string"==typeof e?e:u(e))}function P(t,e){return[s({usr:t.search,key:t.key,idx:e}),d(t)]}function y(t){return!O?.length||(O.call(t),!1)}function v(t){g=t,[E,m]=f(),S.call({location:E,action:g})}let g=a.POP,[E,m]=f();const S=new n,O=new n;function k(t,n){const o=p(t,n);if(y({location:o,action:a.PUSH,retry:function(){k(t,n)}})){const[t,n]=P(o,m+1);e.pushState(t,"",n),v(a.PUSH)}}function w(t){e.go(t)}void 0===m&&(m=0,e.replaceState({...e.state,idx:m},""));let L=null;return t.addEventListener(r,(()=>{if(L)O.call(L),L=null;else if(O.length){const[t,e]=f();if(void 0!==e){const n=m-e;function o(){w(-n)}L={location:t,action:a.POP,retry:o},w(n)}else i("请不要绕过history调用 pushState/replaceState")}else v(a.POP)})),{action:g,location:E,push:k,replace:function(t,n){const o=p(t,n);if(y({location:o,action:a.REPLACE,retry:function(){k(t,n)}})){const[t,n]=P(o,m+1);e.replaceState(t,"",n),v(a.REPLACE)}},createHref:d,go:w,back:()=>{w(-1)},forward:()=>{w(1)},listen:t=>S.listen(t),block:e=>{const n=O.listen(e);return O.length>0&&t.addEventListener(c,l),()=>{n(),0===O.length&&t.removeEventListener(c,l)}}}}var d=e.rc,P=e.zR,y=e.TM;export{d as Action,P as createBrowserHistory,y as createHashHistory};